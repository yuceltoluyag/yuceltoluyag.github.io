"use strict";const styles="";class MastodonComments extends HTMLElement{constructor(){super(),this.host=this.getAttribute("host"),this.user=this.getAttribute("user"),this.tootId=this.getAttribute("tootId"),this.commentsLoaded=!1}connectedCallback(){this.innerHTML=`\n      <div id="mastodon-stats" class="mb-4"></div>\n      <h2 class="text-2xl font-bold mb-3 flex items-center">\n        <iconify-icon icon="tabler:message-circle" class="mr-2"></iconify-icon>\n        Yorumlar\n      </h2>\n\n      <div class="alert bg-base-200 mb-6">\n        <div>\n          <iconify-icon icon="tabler:info-circle" class="text-xl"></iconify-icon>\n          <div>\n            Bu <a class="link link-primary font-medium"\n                href="https://${this.host}/@${this.user}/${this.tootId}" target="_blank" rel="noopener noreferrer">gönderi</a>ye yanıt vermek için \n                Fediverse (örn. Mastodon ve diğerleri) hesabınızı kullanabilirsiniz.\n          </div>\n        </div>\n      </div>\n      <div id="mastodon-comments-list"></div>\n    `;const t=document.getElementById("mastodon-comments-list");this.respondToVisibility(t,this.loadComments.bind(this))}escapeHtml(t){return(t||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}toot_active(t,e){return t[e+"_count"]>0?"active":""}toot_count(t,e){var n=t[e+"_count"];return n>0?n:""}toot_stats(t){const e=this.toot_count(t,"replies"),n=this.toot_count(t,"reblogs"),o=this.toot_count(t,"favourites");return`\n      <div class="replies ${this.toot_active(t,"replies")}">\n        <a href="${t.url}" rel="nofollow noopener noreferrer" target="_blank" title="Yanıtlar">${e}</a>\n      </div>\n      <div class="reblogs ${this.toot_active(t,"reblogs")}">\n        <a href="${t.url}" rel="nofollow noopener noreferrer" target="_blank" title="Boosts">${n}</a>\n      </div>\n      <div class="favourites ${this.toot_active(t,"favourites")}">\n        <a href="${t.url}" rel="nofollow noopener noreferrer" target="_blank" title="Favoriler">${o}</a>\n      </div>\n    `}user_account(t){var e=`@${t.acct}`;-1===t.acct.indexOf("@")&&(e+=`@${new URL(t.url).hostname}`);return e}render_toots(t,e,n){var o=t.filter((t=>t.in_reply_to_id===e)).sort(((t,e)=>t.created_at.localeCompare(e.created_at)));console.log("Rendering toots for in_reply_to_id: "+e+", found:",o.length),o.forEach((e=>{console.log("Rendering toot:",e.id,"visibility:",e.visibility),this.render_toot(t,e,n)}))}render_toot(t,e,n){e.account.display_name=this.escapeHtml(e.account.display_name),e.account.emojis.forEach((t=>{e.account.display_name=e.account.display_name.replace(`:${t.shortcode}:`,`<img src="${this.escapeHtml(t.static_url)}" alt="Emoji ${t.shortcode}" height="20" width="20" />`)}));let o=e.content;e.emojis&&e.emojis.length>0&&(console.log("Processing emojis in toot:",e.id,"emojis:",e.emojis.length),e.emojis.forEach((t=>{const e=`:${t.shortcode}:`,n=`<img src="${this.escapeHtml(t.static_url)}" alt="Emoji ${t.shortcode}" height="20" width="20" />`;o=o.replace(new RegExp(e,"g"),n)}))),o=o.replace(/<a class="u-url mention" href="([^"]+)">(.+?)<\/a>/g,'<a class="u-url mention" href="$1" target="_blank" rel="noopener noreferrer">$2</a>'),o=o.replace(/<a\s+(?![^>]*target=)[^>]*>/gi,(function(t){return t.slice(0,-1)+' target="_blank">'}));const s=`<div class="mastodon-comment" data-depth="${n}">\n        <div class="author">\n          <div class="avatar">\n            <div class="w-12 h-12 rounded-lg">\n              <img src="${this.escapeHtml(e.account.avatar_static)}" class="w-full h-full object-cover" alt="${this.escapeHtml(e.account.display_name)}">\n            </div>\n          </div>\n          <div class="details">\n            <a class="name" href="${e.account.url}" target="_blank" rel="nofollow noopener noreferrer">${e.account.display_name}</a>\n            <a class="user badge badge-ghost" href="${e.account.url}" target="_blank" rel="nofollow noopener noreferrer">${this.user_account(e.account)}</a>\n          </div>\n          <a class="date" href="${e.url}" target="_blank" rel="nofollow noopener noreferrer">\n            <div class="badge badge-outline badge-sm">\n              <iconify-icon icon="tabler:clock" class="mr-1"></iconify-icon>\n              ${e.created_at.substr(0,10)} ${e.created_at.substr(11,8)}\n            </div>\n          </a>\n        </div>\n        <div class="content card-body p-0 py-3">${o}</div>\n        ${e.media_attachments.length>0?`\n        <div class="attachments card bg-base-200 rounded-lg overflow-hidden">\n          ${e.media_attachments.map((t=>"image"===t.type?`<figure><a href="${t.url}" target="_blank" rel="nofollow noopener noreferrer"><img src="${t.preview_url}" alt="${this.escapeHtml(t.description||"Görsel")}" /></a></figure>`:"video"===t.type?`<figure><video controls class="w-full"><source src="${t.url}" type="${t.mime_type}"></video></figure>`:"gifv"===t.type?`<figure><video autoplay loop muted playsinline class="w-full"><source src="${t.url}" type="${t.mime_type}"></video></figure>`:"audio"===t.type?`<div class="card-body"><audio controls class="w-full"><source src="${t.url}" type="${t.mime_type}"></audio></div>`:`<div class="card-body"><a href="${t.url}" target="_blank" rel="nofollow noopener noreferrer" class="btn btn-outline btn-sm">${t.type} <iconify-icon icon="tabler:download"></iconify-icon></a></div>`)).join("")}\n        </div>`:""}\n        <div class="status">\n          ${this.toot_stats(e)}\n        </div>\n      </div>`;var i=document.createElement("div");if("undefined"!=typeof DOMPurify){const t={ADD_ATTR:["target"],ALLOW_UNKNOWN_PROTOCOLS:!0,FORBID_ATTR:[]};i.innerHTML=DOMPurify.sanitize(s.trim(),t);i.querySelectorAll("a").forEach((t=>{t.hasAttribute("target")||t.setAttribute("target","_blank")}))}else i.innerHTML=s.trim();document.getElementById("mastodon-comments-list").appendChild(i.firstChild),this.render_toots(t,e.id,n+1)}loadComments(){if(this.commentsLoaded)return;document.getElementById("mastodon-comments-list").innerHTML='\n        <div class="flex justify-center my-8">\n            <span class="loading loading-spinner loading-md text-primary"></span>\n            <span class="ml-3">Fediverse\'den yorumlar yükleniyor...</span>\n        </div>';let t=this;console.log("Mastodon Comments: Trying to load comments for toot ID: "+this.tootId),this.tootId&&""!==this.tootId.trim()?(fetch("https://"+this.host+"/api/v1/statuses/"+this.tootId).then((t=>{if(!t.ok)throw new Error(`HTTP hata: ${t.status}`);return t.json()})).then((t=>{console.log("Mastodon Comments: Toot data loaded:",t),document.getElementById("mastodon-stats").innerHTML=this.toot_stats(t)})).catch((t=>{console.error("Mastodon Comments: Error loading toot:",t)})),fetch("https://"+this.host+"/api/v1/statuses/"+this.tootId+"/context").then((t=>{if(!t.ok)throw new Error(`Sunucu yanıt vermedi (${t.status})`);return t.json()})).then((e=>{console.log("Mastodon Comments: Context data loaded:",e),e.descendants&&Array.isArray(e.descendants)&&e.descendants.length>0?(console.log("Mastodon Comments: "+e.descendants.length+" comments found."),document.getElementById("mastodon-comments-list").innerHTML="",t.render_toots(e.descendants,t.tootId,0)):(console.log("Mastodon Comments: No comments found."),document.getElementById("mastodon-comments-list").innerHTML=`\n                    <div class="alert alert-info">\n                        <div>\n                            <iconify-icon icon="tabler:message-off" class="text-xl"></iconify-icon>\n                            <div>Henüz yorum bulunamadı. İlk yorumu yapan siz olun!</div>\n                        </div>\n                        <a href="https://${this.host}/@${this.user}/${this.tootId}" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-primary">\n                            <iconify-icon icon="tabler:message-plus" class="mr-2"></iconify-icon>\n                            Yorum Yap\n                        </a>\n                    </div>`),t.commentsLoaded=!0})).catch((t=>{console.error("Mastodon Comments: Error loading context:",t),document.getElementById("mastodon-comments-list").innerHTML=`\n                <div class="alert alert-error">\n                    <div>\n                        <iconify-icon icon="tabler:alert-triangle" class="text-xl"></iconify-icon>\n                        <div>Yorumlar yüklenirken hata oluştu: ${t.message}</div>\n                    </div>\n                    <div>\n                        <a href="https://${this.host}/@${this.user}/${this.tootId}" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-outline">\n                            <iconify-icon icon="tabler:external-link" class="mr-2"></iconify-icon>\n                            Mastodon'da Görüntüle\n                        </a>\n                    </div>\n                </div>`}))):document.getElementById("mastodon-comments-list").innerHTML='\n            <div class="alert alert-warning">\n                <div>\n                    <iconify-icon icon="tabler:alert-circle" class="text-xl"></iconify-icon>\n                    <div>Geçerli bir Mastodon toot ID\'si belirtilmedi.</div>\n                </div>\n            </div>'}respondToVisibility(t,e){new IntersectionObserver(((t,n)=>{t.forEach((t=>{t.intersectionRatio>0&&e()}))}),{root:null}).observe(t)}}customElements.define("mastodon-comments",MastodonComments);